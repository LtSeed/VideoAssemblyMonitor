<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) on Wed Apr 16 22:49:15 CST 2025 -->
<title>PythonServerLoadBalancer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2025-04-16">
<meta name="description" content="declaration: package: nusri.fyp.demo.service.img_sender.python, class: PythonServerLoadBalancer">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">nusri.fyp.demo.service.img_sender.python</a></div>
<h1 title="Class PythonServerLoadBalancer" class="title">Class PythonServerLoadBalancer</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">nusri.fyp.demo.service.img_sender.python.PythonServerLoadBalancer</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations">@EnableAsync
</span><span class="modifiers">public class </span><span class="element-name type-name-label">PythonServerLoadBalancer</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block"><b>Service responsible for load balancing among multiple Python server instances.</b>
 <br>
 This class maintains a list of Python server instances (each with its own queue size and port) and
 periodically fetches updated information about them. It then selects the best instance based on the smallest queue
 size for forwarding image processing tasks.
 <p>
 Key responsibilities:
 <ul>
     <li>Periodically fetch and update available Python instances (via <a href="#fetchPythonInstancesAsync()"><code>fetchPythonInstancesAsync()</code></a>).</li>
     <li>Provide a method to obtain the "best" (least-loaded) instance (via <a href="#getBestInstance()"><code>getBestInstance()</code></a>).</li>
     <li>Lock-based synchronization to update and read shared state safely.</li>
     <li>Support for an adaptive grouping mechanism to move through instances in increasing queue-size order.</li>
 </ul>
 <br>
 Usage scenario:
 <br> - This service is typically used by <a href="ImageSenderOfPython.html" title="class in nusri.fyp.demo.service.img_sender.python"><code>ImageSenderOfPython</code></a> (and others) to balance
 the load among multiple Python servers when sending images for processing.
 <p>
 Note:
 <br> - The fetch interval is 250 ms, which can be adjusted based on performance needs.
 <br> - If no instances are available, <a href="#getBestInstance()"><code>getBestInstance()</code></a> will block, retrying until an instance appears.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>1.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="ImageSenderOfPython.html" title="class in nusri.fyp.demo.service.img_sender.python"><code>ImageSenderOfPython</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="PythonServerLoadBalancer.Instance.html" class="type-name-link" title="class in nusri.fyp.demo.service.img_sender.python">PythonServerLoadBalancer.Instance</a></code></div>
<div class="col-last even-row-color">
<div class="block"><b>Represents a single Python server instance.</b>
 <br> Each instance has:
 
     A queue size (string representation) indicating how many tasks are queued.
     A port number where the instance is listening for requests.
 </div>
</div>
<div class="col-first odd-row-color"><code>static class&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="PythonServerLoadBalancer.InstancesResponse.html" class="type-name-link" title="class in nusri.fyp.demo.service.img_sender.python">PythonServerLoadBalancer.InstancesResponse</a></code></div>
<div class="col-last odd-row-color">
<div class="block"><b>Represents the response structure returned by the /instances endpoint.</b>
 <br> Contains a list of <a href="PythonServerLoadBalancer.Instance.html" title="class in nusri.fyp.demo.service.img_sender.python"><code>PythonServerLoadBalancer.Instance</code></a> objects detailing queue sizes and ports for each Python instance.</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(java.lang.String,java.lang.String)" class="member-name-link">PythonServerLoadBalancer</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pythonHost,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;mainPort)</code></div>
<div class="col-last even-row-color">
<div class="block">Constructs the load balancer service with an initial list of Python instances.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#fetchPythonInstancesAsync()" class="member-name-link">fetchPythonInstancesAsync</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Scheduled method that periodically updates <code>pythonInstances</code> by fetching the /instances endpoint.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getBestInstance()" class="member-name-link">getBestInstance</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns the host/port URL of the "best" Python instance for image processing.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="PythonServerLoadBalancer.Instance.html" title="class in nusri.fyp.demo.service.img_sender.python">PythonServerLoadBalancer.Instance</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getPythonInstances()" class="member-name-link">getPythonInstances</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Retrieves the list of Python server instances from the main server's /instances endpoint.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#resetUnusedTime()" class="member-name-link">resetUnusedTime</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Resets the internal unused-time counter, indicating that the system is currently active (receiving requests).</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(java.lang.String,java.lang.String)">
<h3>PythonServerLoadBalancer</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">PythonServerLoadBalancer</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pythonHost,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;mainPort)</span></div>
<div class="block">Constructs the load balancer service with an initial list of Python instances.
 <br> The list is retrieved by calling <a href="#getPythonInstances()"><code>getPythonInstances()</code></a> immediately.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>pythonHost</code> - The host URL (e.g., "http://127.0.0.1") where instance info is served</dd>
<dd><code>mainPort</code> - The port on that host where the /instances endpoint can be accessed</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="fetchPythonInstancesAsync()">
<h3>fetchPythonInstancesAsync</h3>
<div class="member-signature"><span class="annotations">@Scheduled(fixedRate=250L)
</span><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">fetchPythonInstancesAsync</span>()</div>
<div class="block">Scheduled method that periodically updates <code>pythonInstances</code> by fetching the /instances endpoint.
 <br> Runs every 250 ms. If the system has been idle (i.e., no requests) for more than 5 cycles, it stops fetching
 to reduce overhead until load resumes.
 <br>
 Once the new list is fetched, it is sorted by ascending queue size. The group size is reset based on the new
 available instance count (with a minimum of 2).</div>
</section>
</li>
<li>
<section class="detail" id="getPythonInstances()">
<h3>getPythonInstances</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="PythonServerLoadBalancer.Instance.html" title="class in nusri.fyp.demo.service.img_sender.python">PythonServerLoadBalancer.Instance</a>&gt;</span>&nbsp;<span class="element-name">getPythonInstances</span>()</div>
<div class="block">Retrieves the list of Python server instances from the main server's /instances endpoint.
 <br> If an error occurs, returns an empty list.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>A <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link"><code>List</code></a> of <a href="PythonServerLoadBalancer.Instance.html" title="class in nusri.fyp.demo.service.img_sender.python"><code>PythonServerLoadBalancer.Instance</code></a> objects, sorted by ascending queue size.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getBestInstance()">
<h3>getBestInstance</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">getBestInstance</span>()</div>
<div class="block">Returns the host/port URL of the "best" Python instance for image processing.
 <br> Selection is based on an adaptive grouping mechanism:
 <ul>
   <li>We group the instances in sets of size <code>currentGroupSize</code>, sorted by queue size.</li>
   <li>We pick the instance at <code>indexWithinGroup</code> in the current group.</li>
   <li>Once the group is exhausted (i.e., <code>indexWithinGroup &gt;= currentGroupSize</code>), we increment <code>currentGroupSize</code>
       to move on to the next group and reset <code>indexWithinGroup</code> to 0.</li>
 </ul>
 <br>
 If no instances are available at the moment, the method will sleep and retry until it finds one.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>A string of the form "<code>http://host:port</code>" representing the chosen Python instance</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="resetUnusedTime()">
<h3>resetUnusedTime</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">resetUnusedTime</span>()</div>
<div class="block">Resets the internal unused-time counter, indicating that the system is currently active (receiving requests).
 <br> The fetch task in <a href="#fetchPythonInstancesAsync()"><code>fetchPythonInstancesAsync()</code></a> uses this counter to modulate how frequently it
 attempts to refresh the instance list when the system is idle.</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
